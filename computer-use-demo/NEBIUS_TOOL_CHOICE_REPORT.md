# –û—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ tool_choice –≤ Nebius - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ 4 –º–æ–¥–µ–ª–µ–π

## üî¨ –¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏:
1. **mistralai/Mistral-Small-3.1-24B-Instruct-2503**
2. **google/gemma-3-27b-it**
3. **Qwen/Qwen2-VL-72B-Instruct**
4. **Qwen/Qwen2.5-VL-72B-Instruct**

## üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –º–æ–¥–µ–ª—è–º:

### 1. ÔøΩ mistralai/Mistral-Small-3.1-24B-Instruct-2503 (0/5 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏)

| tool_choice | –†–µ–∑—É–ª—å—Ç–∞—Ç | –û—à–∏–±–∫–∞ |
|-------------|-----------|---------|
| `None` | ‚ùå | This model does not support auto tool |
| –ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ | ‚ùå | This model does not support auto tool |
| `"auto"` | ‚ùå | This model does not support auto tool |
| `"required"` | ‚ùå | Chat template error (transformers v4.44) |
| –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | ‚ùå | Chat template error (transformers v4.44) |

### 2. ÔøΩ google/gemma-3-27b-it (0/5 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏)

| tool_choice | –†–µ–∑—É–ª—å—Ç–∞—Ç | –û—à–∏–±–∫–∞ |
|-------------|-----------|---------|
| `None` | ‚ùå | This model does not support auto tool |
| –ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ | ‚ùå | This model does not support auto tool |
| `"auto"` | ‚ùå | This model does not support auto tool |
| `"required"` | ‚ùå | JSON schema not supported by xgrammar |
| –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | ‚ùå | JSON schema not supported by xgrammar |

### 3. üü° Qwen/Qwen2-VL-72B-Instruct (2/6 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏)

| tool_choice | –†–µ–∑—É–ª—å—Ç–∞—Ç | –û—à–∏–±–∫–∞/–†–µ–∑—É–ª—å—Ç–∞—Ç |
|-------------|-----------|---------|
| `None` | ‚ùå | This model does not support auto tool |
| –ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ | ‚ùå | This model does not support auto tool |
| `"auto"` | ‚ùå | This model does not support auto tool |
| `"required"` | ‚ùå | Must be named tool, "auto", or "none" |
| `"none"` | ‚úÖ | **–†–ê–ë–û–¢–ê–ï–¢!** –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã |
| –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | ‚úÖ | **–†–ê–ë–û–¢–ê–ï–¢!** –í—ã–∑–≤–∞–ª computer tool |

### 4. üü¢ Qwen/Qwen2.5-VL-72B-Instruct (3/6 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏)

| tool_choice | –†–µ–∑—É–ª—å—Ç–∞—Ç | –û—à–∏–±–∫–∞/–†–µ–∑—É–ª—å—Ç–∞—Ç |
|-------------|-----------|---------|
| `None` | ‚ùå | This model does not support auto tool |
| –ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ | ‚ùå | This model does not support auto tool |
| `"auto"` | ‚ùå | This model does not support auto tool |
| `"required"` | ‚úÖ | **–†–ê–ë–û–¢–ê–ï–¢!** –í—ã–∑–≤–∞–ª str_replace_editor |
| `"none"` | ‚úÖ | **–†–ê–ë–û–¢–ê–ï–¢!** –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã |
| –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | ‚úÖ | **–†–ê–ë–û–¢–ê–ï–¢!** –í—ã–∑–≤–∞–ª computer tool |

## üéØ –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã:

### ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢ –Ω–∏ –≤ –æ–¥–Ω–æ–π –º–æ–¥–µ–ª–∏:
- `tool_choice=None` (Python None)
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `tool_choice` –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ `tools`
- `tool_choice="auto"`

**–í—Å–µ –º–æ–¥–µ–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –æ—à–∏–±–∫—É:**
```
This model does not support auto tool, please use tool_choice.
```

### ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ —á–∞—Å—Ç–∏—á–Ω–æ:

1. **Qwen/Qwen2.5-VL-72B-Instruct** - –õ–£–ß–®–ê–Ø –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (3/6):
   - ‚úÖ `tool_choice="required"` 
   - ‚úÖ `tool_choice="none"`
   - ‚úÖ `tool_choice={"type": "function", "function": {"name": "tool_name"}}`

2. **Qwen/Qwen2-VL-72B-Instruct** - –•–æ—Ä–æ—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (2/6):
   - ‚úÖ `tool_choice="none"`
   - ‚úÖ `tool_choice={"type": "function", "function": {"name": "tool_name"}}`
   - ‚ùå `tool_choice="required"` (–≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞)

3. **mistralai/Mistral-Small** –∏ **google/gemma-3** - –ù–ï–¢ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

### üîß –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –ø–æ –º–æ–¥–µ–ª—è–º:

- **Mistral**: –ü—Ä–æ–±–ª–µ–º—ã —Å chat template (transformers v4.44)
- **Gemma**: JSON schema incompatible —Å xgrammar
- **Qwen2-VL**: –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `"required"` 
- **Qwen2.5-VL**: –ù–∞–∏–ª—É—á—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê –¥–ª—è loop.py:

**–¢–µ–∫—É—â–∏–π –∫–æ–¥ –≤ loop.py —Å—Ç—Ä–æ–∫–∞ 436:**
```python
tool_choice=None  # ‚ùå –≠—Ç–æ –ù–ï –†–ê–ë–û–¢–ê–ï–¢ –Ω–∏ –≤ –æ–¥–Ω–æ–π –º–æ–¥–µ–ª–∏!
```

## üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:

### –î–ª—è –∫–æ–¥–∞ –≤ loop.py:

```python
# –í–º–µ—Å—Ç–æ tool_choice=None –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
if provider == APIProvider.NEBIUS:
    if model in ["Qwen/Qwen2.5-VL-72B-Instruct"]:
        tool_choice = "required"  # –õ—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è Qwen2.5-VL
    elif model in ["Qwen/Qwen2-VL-72B-Instruct"]:
        # –£–∫–∞–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π
        tool_choice = {"type": "function", "function": {"name": first_tool_name}}
    else:
        # –î–ª—è Mistral –∏ Gemma - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤–æ–æ–±—â–µ
        tools = None
        tool_choice = None
else:
    tool_choice = None  # –î–ª—è –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (Anthropic, etc.)
```

### –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–π—Ç–∏–Ω–≥ –º–æ–¥–µ–ª–µ–π –ø–æ –ø–æ–¥–¥–µ—Ä–∂–∫–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:

1. ü•á **Qwen/Qwen2.5-VL-72B-Instruct** - –æ—Ç–ª–∏—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (3/6)
2. ü•à **Qwen/Qwen2-VL-72B-Instruct** - —Ö–æ—Ä–æ—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (2/6)  
3. ü•â **mistralai/Mistral-Small-3.1-24B-Instruct-2503** - –Ω–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (0/6)
4. ü•â **google/gemma-3-27b-it** - –Ω–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (0/6)

### üîç –í–ê–ñ–ù–û–ï –û–¢–ö–†–´–¢–ò–ï –ø—Ä–æ `tool_choice="none"`:

–û–±–µ –º–æ–¥–µ–ª–∏ Qwen –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç `tool_choice="none"`, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤ –∑–∞–ø—Ä–æ—Å–µ
- –ù–æ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –º–æ–¥–µ–ª–∏ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö
- –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è fallback —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```python
# –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –¥–∞—Ç—å –º–æ–¥–µ–ª–∏ –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º, –Ω–æ –Ω–µ –ø—Ä–∏–Ω—É–∂–¥–∞—Ç—å –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
tool_choice = "none"  # –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è Qwen –º–æ–¥–µ–ª–µ–π

# –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–∏–Ω—É–¥–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
tool_choice = "required"  # –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è Qwen2.5-VL

# –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —É–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç  
tool_choice = {"type": "function", "function": {"name": "computer"}}  # –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –æ–±–µ–∏—Ö Qwen
```
